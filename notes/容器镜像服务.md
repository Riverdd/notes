# 容器镜像服务

## 产品功能参考

- [阿里云ACR](https://help.aliyun.com/document_detail/257112.html)

- [腾讯云TCR](https://cloud.tencent.com/document/product/1141/39278)

## harbor调研
- [ ] 命名空间限额(project)
- [ ] 公开仓库限额(public repository)
- [ ] 私有仓库限额(private repository)
- [ ] VPC访问控制限额
- [x] OCI Artifact
- [x] 自动清理
- 

[harbor对接oss](https://docs.docker.com/registry/configuration/#storage)
```
oss:
    accesskeyid: accesskeyid
    accesskeysecret: accesskeysecret
    region: OSS region name
    endpoint: optional endpoints
    internal: optional internal endpoint
    bucket: OSS bucket
    encrypt: optional data encryption setting
    secure: optional ssl setting
    chunksize: optional size valye
    rootdirectory: optional root directory
```

镜像构建 buildkit

扫描器
https://goharbor.io/blog/harbor-1.10-release/#vulnerability-scanning-with-pluggable-scanners


```
  s3:
    accesskey: a12c8b3a-0009-435a-98ab-d9fc69f495ce
    secretkey: 136a4b2f-8191-4122-8557-cc38c8a6d1ee
    regionendpoint: https://cn-east-1.cloud-oss.com
    region: cn-east-1
    bucket: jackyoss
    v4auth: true
    secure: true
    rootdirectory: /harbor
    multipartcopythresholdsize: 5368709120
  redirect:
    disabled: true
```

[estargz stargz-snapshotter介绍](https://zhuanlan.zhihu.com/p/346829631)

[阿里架构介绍](https://www.infoq.cn/article/V2IiityHOSojXmqqfyza)

[dragonfly](https://d7y.io/zh/docs/)

[nydus](https://github.com/dragonflyoss/image-service)

[nydus](https://nydus.dev)

[nydus](https://zhuanlan.zhihu.com/p/528796238)

[DADI overlaydb](https://segmentfault.com/a/1190000039790517)


nydus镜像转换吃cpu

robot$acceleration
uXT3wpqQrbBNpnoFj6vbmnaG0QQahw71

cm9ib3QkYWNjZWxlcmF0aW9uOnVYVDN3cHFRcmJCTnBub0ZqNnZibW5hRzBRUWFodzcx

robot$acceleration
EyjguoWY6i8f5LHFjMPchlitFxGbzC7a
cm9ib3QkYWNjZWxlcmF0aW9uOkV5amd1b1dZNmk4ZjVMSEZqTVBjaGxpdEZ4R2J6Qzdh

```
{
  "device": {
    "backend": {
      "type": "registry",
      "config": {
        "scheme": "https",
        "timeout": 5,
        "connect_timeout": 5,
        "retry_limit": 0,
        "auth":"cn-north-1-harbor.yovole.tech:YWRtaW46WW92b2xlQDIwMjI="
      }
    },
    "cache": {
      "type": "blobcache",
      "config": {
        "work_dir": "/cache"
      }
    }
  },
  "mode": "direct",
  "digest_validate": false,
  "iostats_files": true,
  "enable_xattr": true,
  "fs_prefetch": {
    "enable": false,
    "threads_count": 4,
    "merging_size": 131072,
    "bandwidth_rate": 1048576
  }
}
```
镜像转换吃cpu
镜像上传吃cpu
镜像扫描吃内存和cpu

[clair](https://quay.github.io/clair/whatis.html)

[trivy](https://aquasecurity.github.io/trivy/v0.32/)

[harbor-scanner-adapters](https://goharbor.io/docs/edge/install-config/harbor-compatibility-list/#scanner-adapters)